#!/bin/bash

scripts/clean
source scripts/variables
mkdir release

for OS in "windows" "darwin" "linux"; do
  DIR="release/dankgrinder-${VERSION}-${OS}-amd64"
  DANKGRINDER="dankgrinder"
  CANDY="candy"

  if [ "${OS}" = "windows" ]; then
    DANKGRINDER="${DANKGRINDER}.exe"
    CANDY="${CANDY}.exe"
  fi

  mkdir "${DIR}"
  cp config.yml "${DIR}"
  (cd cmd/dankgrinder || exit; GOOS=${OS} GOARCH=amd64 go build -v -o "../../${DIR}/${DANKGRINDER}" .)
  (cd cmd/candy || exit; GOOS=${OS} GOARCH=amd64 go build -v -o "../../${DIR}/${CANDY}" .)
  zip -vr9j "${DIR}".zip "${DIR}"/*
  rm -rf "${DIR}"
done
